{% extends 'templateBase.html.twig' %}


{% block titlePage %} </h1>
<div class="col-md-8 "> </div>
<div class="col-md-2" style="text-align:center;">
<!-- Notation de l'utilisateur, 'noteARemplacer' sera remplacé dynamiquement en JS -->
<span style="display: inline-block;"> Ma note: <div class='rateYo' data-rating="5" href="{{path('post_noter', {'id':post.id, 'noteEtoiles': 'noteARemplacer'})}}"></div> </span>

        </div>
<div class="col-md-2 ">

Note moyenne: <div class='rateYo' data-rating="3" data-readonly=true></div>

 </div>
{% endblock %}
{% block contenuCentral %}

    <div class="row">
        <div class="col-md-3">
             <img src=" {{ post.emplacementPhoto }}" class="img-thumbnail" height="100px" width="100px">  
        </div>
        <div class="col-md-9" style="display: flex; align-items: center;"5%;"> 
            <h3>
                 {{post.titre}}
            </h3>  
        </div>
    </div>
     <hr>


    <dl class="row">
        <dt class="col-sm-3">Createur</dt>
        <dd class="col-sm-9"> {{ post.createur.pseudo }} </dd>

        <dt class="col-sm-3">Date</dt>
        <dd class="col-sm-9"> {{ post.datePubli|date('d-m-Y') }} </dd>

        <dt class="col-sm-3">Description</dt>
        <dd class="col-sm-9"> {{ post.description }} </dd>

        <dt class="col-sm-3">Ressources</dt>
        <dd class="col-sm-9">   
            {% for ressource in post.ressources %} 

                    <a href="{{ressource.emplacement}}" target="_blank" style="color: var(--brique)"> {{ressource.nom}}{{ressource.typeDeFichier}} </a> <br>

            {% endfor %}
        </dd>

        <dt class="col-sm-3">Mots clés</dt>
        <dd class="col-sm-9">   
            {% for motCle in post.motsCles %} 

                    {{ motCle.motCle }}
                    {% if loop.last == false %} , {% endif %}

            {% endfor %}
        </dd>
    </dl>


    
{% endblock %}

{% block contenuDroit %}
    <div style="text-align:center;">
        <a href="{{ path('post_enFavori', {'id':post.id}) }}" class="btn js-favori">
            {% if post.estUnFavori(app.user) %}
                <i class="fas fa-star"></i>
            {% else %}
                <span id="js-fav-text"> <b> Mettre en favori </b> </span>
                <i class="far fa-star"></i>
            {% endif %}
        </a>
    </div>    
    <br>

    <b> Modules: </b> 


    {% for module in post.modules %} 
        <br>
        <span data-toggle="tooltip" title="{{ module.nom }}" data-placement="left"> 
        
            {{module.sigle}}

        </span>
    
    {% endfor %}

{% endblock %}

{% block buttons %}
    {% if post.createur != app.user  %}
        {% if post.signale %}
            <a class="btn posBD btn-success disabled"><i class="fas fa-exclamation-circle"></i> Signaler</a>
        {% else %}
            <a class="btn btn-success posBD signaler" href="{{ path('post_signaler', {'id': post.id}) }}" role="button"> <i class="fas fa-exclamation-circle"></i> Signaler</a>
        {% endif %}
    {% else %}
        <div class="notation">
        <a class="btn btn-success posBD" href="{{ path('post_edit', {'id': post.id}) }}"><i class="fas fa-pencil-alt"></i> Modifier</a> 
        {{ include('post/_delete_form.html.twig') }} 
        </div>
    {% endif %}

{% endblock %}

{% block Javascript %}
<script>




    $.each($('.rateYo'), function(){

    var $self = $(this);

    $self.rateYo({
        rating: $self.data('rating'),
        fullStar: true,
        ratedFill: "gold",
        starWidth: "20px",
        readOnly: $self.data('readonly'),

        onSet: function (rating, rateYoInstance) {
    console.log($self.data('read'));
        var href = $(this).attr('href');


        // on remplace la valeur 'placeholder' dans la route par la note attribuée
        href = href.replace('noteARemplacer', rating);

        console.log(href);
        axios.get(href).then(function(response){
        }) 

        } 
    });
    });

</script>
{% endblock %}